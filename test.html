<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>One-Time Payment - Direct App Switch Flow - PayPal Web SDK</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      paypal-button {
        width: 100%;
        max-width: 500px;
      }
    </style>
  </head>
  <body>
    <paypal-button class="paypal-blue"></paypal-button>
    <script src="assets/js/paypal/utils.js" defer></script>
    <script defer>
      async function onPayPalWebSdkLoaded() {
        try {
          const clientToken = await getBrowserSafeClientToken();
          const sdkInstance = await window.paypal.createInstance({
            clientToken,
            components: ["paypal-payments"],
            pageType: "checkout",
          });
          const paypalPaymentSession = sdkInstance.createPayPalOneTimePaymentSession(
            paymentSessionOptions,
          );

          if (paypalPaymentSession.hasReturned()) {
            await paypalPaymentSession.resume();
          } else {
            setupPayPalButton(paypalPaymentSession);
          }
        } catch (error) {
          console.error(error);
        }
      }

      const paymentSessionOptions = {
        async onApprove(data) {
          console.log("onApprove", data);
          const orderData = await captureOrder({
            orderId: data.orderId,
          });
          console.log("Capture result", orderData);
        },
        onCancel(data) {
          console.log("onCancel", data);
        },
        onError(error) {
          console.log("onError", error);
        },
      };

      async function setupPayPalButton(paypalPaymentSession) {
        const paypalButton = document.querySelector("[paypal-button]");

        document.addEventListener("click", async (event) => {
          console.log(event.target.tagName);
          if (event.target.tagName === "paypal-button") {
            const createOrderIdPromiseReference = createOrder();
            try {
              await paypalPaymentSession.start(
                { presentationMode: "direct-app-switch" },
                createOrderIdPromiseReference,
              );
            } catch (error) {
              console.error(error);
              await paypalPaymentSession.start(
                { presentationMode: "auto" },
                createOrderIdPromiseReference,
              );
            }
          }
        });
      }

    </script>
    <script onload="onPayPalWebSdkLoaded()" src="https://www.sandbox.paypal.com/web-sdk/v6/core" defer></script>
  </body>
</html>